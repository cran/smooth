<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Ivan Svetunkov" />

<meta name="date" content="2017-10-27" />

<title>es() - Exponential Smoothing</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">es() - Exponential Smoothing</h1>
<h4 class="author"><em>Ivan Svetunkov</em></h4>
<h4 class="date"><em>2017-10-27</em></h4>



<p><code>es()</code> is a part of <a href="smooth.html">smooth package</a>. It allows constructing Exponential Smoothing (also known as ETS), selecting the most appropriate one among 30 possible ones, including exogenous variables and many more.</p>
<p>In this vignette we will use data from <code>Mcomp</code> package, so it is advised to install it.</p>
<p>Let’s load the necessary packages:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(smooth)
<span class="kw">require</span>(Mcomp)</code></pre></div>
<p>You may note that <code>Mcomp</code> depends on <code>forecast</code> package and if you load both <code>forecast</code> and <code>smooth</code>, then you will have a message that <code>forecast()</code> function is masked from the environment. There is nothing to be worried about - <code>smooth</code> uses this function for consistency purposes and has exactly the same original <code>forecast()</code> as in the <code>forecast</code> package. The inclusion of this function in <code>smooth</code> was done only in order not to include <code>forecast</code> in dependencies of the package.</p>
<p>The simplest call of this function is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Time elapsed: 0.29 seconds
## Model estimated: ETS(MNN)
## Persistence vector g:
## alpha 
## 0.145 
## Initial values were optimised.
## 3 parameters were estimated in the process
## Residuals standard deviation: 0.413
## Cost function type: MSE; Cost function value: 1288657.07
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1645.978 1646.236 1653.702 
## Forecast errors:
## MPE: 26.3%; Bias: 87%; MAPE: 39.8%; SMAPE: 49.4%
## MASE: 2.944; sMAE: 120.1%; RelMAE: 1.258; sMSE: 242.7%</code></pre>
<p>In this case function uses branch and bound algorithm to form a pool of models to check and after that constructs a model with the lowest information criterion. As we can see, it also produces an output with brief information about the model, which contains:</p>
<ol style="list-style-type: decimal">
<li>How much time was elapsed for the model construction;</li>
<li>What type of ETS was selected;</li>
<li>Values of persistence vector (smoothing parameters);</li>
<li>What type of initialisation was used;</li>
<li>How many parameters were estimated (standard deviation is included);</li>
<li>Standard deviation of residuals. The model has multiplicative error term, so as a result the standard deviation is small.</li>
<li>Cost function type and the value of that cost function;</li>
<li>Information criteria for this model;</li>
<li>Forecast errors (because we have set <code>holdout=TRUE</code>).</li>
</ol>
<p>The function has also produced a graph with actuals, fitted values and point forecasts.</p>
<p>If we need prediction intervals, then we run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">intervals=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Time elapsed: 0.23 seconds
## Model estimated: ETS(MNN)
## Persistence vector g:
## alpha 
## 0.145 
## Initial values were optimised.
## 3 parameters were estimated in the process
## Residuals standard deviation: 0.413
## Cost function type: MSE; Cost function value: 1288657.07
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1645.978 1646.236 1653.702 
## 95% parametric prediction intervals were constructed
## 72% of values are in the prediction interval
## Forecast errors:
## MPE: 26.3%; Bias: 87%; MAPE: 39.8%; SMAPE: 49.4%
## MASE: 2.944; sMAE: 120.1%; RelMAE: 1.258; sMSE: 242.7%</code></pre>
<p>Due to multiplicative nature of error term in the model, the intervals are asymmetric. This is the expected behaviour. The other thing to note is that the output now also provides the theoretical width of prediction intervals and its actual coverage.</p>
<p>If we save the model (and let’s say we want it to work silently):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ourModel &lt;-<span class="st"> </span><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">silent=</span><span class="st">&quot;all&quot;</span>)</code></pre></div>
<p>we can then reuse it for different purposes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span>ourModel, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">FALSE</span>, <span class="dt">intervals=</span><span class="st">&quot;np&quot;</span>, <span class="dt">level=</span><span class="fl">0.93</span>)</code></pre></div>
<pre><code>## Time elapsed: 0.07 seconds
## Model estimated: ETS(MNN)
## Persistence vector g:
## alpha 
## 0.145 
## Initial values were provided by user.
## 1 parameter was estimated in the process
## 2 parameters were provided
## Residuals standard deviation: 0.431
## Cost function type: MSE; Cost function value: 1965686.226
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1994.861 1994.897 1997.606 
## 93% nonparametric prediction intervals were constructed</code></pre>
<p>We can also extract the type of model in order to reuse it later:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">modelType</span>(ourModel)</code></pre></div>
<pre><code>## [1] &quot;MNN&quot;</code></pre>
<p>This handy function, by the way, also works with ets() from forecast package.</p>
<p>We can then use persistence or initials only from the model to construct the other one:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="kw">modelType</span>(ourModel), <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">FALSE</span>, <span class="dt">initial=</span>ourModel<span class="op">$</span>initial, <span class="dt">silent=</span><span class="st">&quot;graph&quot;</span>)</code></pre></div>
<pre><code>## Time elapsed: 0.02 seconds
## Model estimated: ETS(MNN)
## Persistence vector g:
## alpha 
## 0.151 
## Initial values were provided by user.
## 2 parameters were estimated in the process
## 1 parameter was provided
## Residuals standard deviation: 0.432
## Cost function type: MSE; Cost function value: 1965400.549
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1996.845 1996.952 2002.334</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="kw">modelType</span>(ourModel), <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">FALSE</span>, <span class="dt">persistence=</span>ourModel<span class="op">$</span>persistence, <span class="dt">silent=</span><span class="st">&quot;graph&quot;</span>)</code></pre></div>
<pre><code>## Time elapsed: 0.02 seconds
## Model estimated: ETS(MNN)
## Persistence vector g:
## alpha 
## 0.145 
## Initial values were optimised.
## 2 parameters were estimated in the process
## 1 parameter was provided
## Residuals standard deviation: 0.432
## Cost function type: MSE; Cost function value: 1965686.226
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1996.861 1996.968 2002.351</code></pre>
<p>or provide some arbitrary values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="kw">modelType</span>(ourModel), <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">FALSE</span>, <span class="dt">initial=</span><span class="dv">1500</span>, <span class="dt">silent=</span><span class="st">&quot;graph&quot;</span>)</code></pre></div>
<pre><code>## Time elapsed: 0.02 seconds
## Model estimated: ETS(MNN)
## Persistence vector g:
## alpha 
##  0.15 
## Initial values were provided by user.
## 2 parameters were estimated in the process
## 1 parameter was provided
## Residuals standard deviation: 0.433
## Cost function type: MSE; Cost function value: 1968545.705
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1997.029 1997.136 2002.518</code></pre>
<p>Using some other parameters may lead to completely different model and forecasts:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">cfType=</span><span class="st">&quot;aMSTFE&quot;</span>, <span class="dt">bounds=</span><span class="st">&quot;a&quot;</span>, <span class="dt">ic=</span><span class="st">&quot;BIC&quot;</span>, <span class="dt">intervals=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Time elapsed: 0.37 seconds
## Model estimated: ETS(MNN)
## Persistence vector g:
## alpha 
##  0.08 
## Initial values were optimised.
## 3 parameters were estimated in the process
## Residuals standard deviation: 0.42
## Cost function type: aMSTFE; Cost function value: 246.291
## 
## Information criteria:
##      AIC     AICc      BIC 
## 25551.52 25556.16 25690.55 
## 95% parametric prediction intervals were constructed
## 72% of values are in the prediction interval
## Forecast errors:
## MPE: 33.3%; Bias: 90.4%; MAPE: 43.3%; SMAPE: 56.3%
## MASE: 3.232; sMAE: 131.9%; RelMAE: 1.381; sMSE: 277.6%</code></pre>
<p>You can play around with all the available parameters to see what’s their effect on final model.</p>
<p>In order to combine forecasts we need to use “C” letter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="st">&quot;CCN&quot;</span>, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">silent=</span><span class="st">&quot;graph&quot;</span>)</code></pre></div>
<pre><code>## Estimation progress:    10%20%30%40%50%60%70%80%90%100%... Done!</code></pre>
<pre><code>## Time elapsed: 0.59 seconds
## Model estimated: ETS(CCN)
## Initial values were optimised.
## Residuals standard deviation: 1408.59
## Cost function type: MSE
## 
## Information criteria:
## Combined AICc 
##      1647.651 
## Forecast errors:
## MPE: 27.8%; Bias: 88.4%; MAPE: 40.5%; SMAPE: 50.8%
## MASE: 3.005; sMAE: 122.6%; RelMAE: 1.284; sMSE: 249.9%</code></pre>
<p>Model selection from a specified pool and forecasts combination are called using respectively:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="kw">c</span>(<span class="st">&quot;ANN&quot;</span>,<span class="st">&quot;AAN&quot;</span>,<span class="st">&quot;AAdN&quot;</span>,<span class="st">&quot;ANA&quot;</span>,<span class="st">&quot;AAA&quot;</span>,<span class="st">&quot;AAdA&quot;</span>), <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">silent=</span><span class="st">&quot;graph&quot;</span>)</code></pre></div>
<pre><code>## Estimation progress:    17%33%50%67%83%100%... Done!</code></pre>
<pre><code>## Time elapsed: 0.48 seconds
## Model estimated: ETS(ANN)
## Persistence vector g:
## alpha 
## 0.158 
## Initial values were optimised.
## 3 parameters were estimated in the process
## Residuals standard deviation: 1439.368
## Cost function type: MSE; Cost function value: 2007704.532
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1688.987 1689.245 1696.711 
## Forecast errors:
## MPE: 25.3%; Bias: 86%; MAPE: 39.4%; SMAPE: 48.6%
## MASE: 2.909; sMAE: 118.7%; RelMAE: 1.243; sMSE: 238.1%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="kw">c</span>(<span class="st">&quot;CCC&quot;</span>,<span class="st">&quot;ANN&quot;</span>,<span class="st">&quot;AAN&quot;</span>,<span class="st">&quot;AAdN&quot;</span>,<span class="st">&quot;ANA&quot;</span>,<span class="st">&quot;AAA&quot;</span>,<span class="st">&quot;AAdA&quot;</span>), <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">silent=</span><span class="st">&quot;graph&quot;</span>)</code></pre></div>
<pre><code>## Estimation progress:    17%33%50%67%83%100%... Done!</code></pre>
<pre><code>## Time elapsed: 0.51 seconds
## Model estimated: ETS(CCC)
## Initial values were optimised.
## Residuals standard deviation: 1386.78
## Cost function type: MSE
## 
## Information criteria:
## Combined AICc 
##      1690.145 
## Forecast errors:
## MPE: 17.2%; Bias: 77.7%; MAPE: 37.3%; SMAPE: 43.2%
## MASE: 2.658; sMAE: 108.5%; RelMAE: 1.136; sMSE: 206.8%</code></pre>
<p>Now let’s introduce some artificial exogenous variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(<span class="kw">length</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x),<span class="dv">50</span>,<span class="dv">3</span>),<span class="kw">rnorm</span>(<span class="kw">length</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x),<span class="dv">100</span>,<span class="dv">7</span>))</code></pre></div>
<p>and fit a model with all the exogenous first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="st">&quot;ZZZ&quot;</span>, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">xreg=</span>x)</code></pre></div>
<pre><code>## Time elapsed: 0.42 seconds
## Model estimated: ETSX(MNN)
## Persistence vector g:
## alpha 
## 0.145 
## Initial values were optimised.
## 5 parameters were estimated in the process
## Residuals standard deviation: 0.414
## Xreg coefficients were estimated in a normal style
## Cost function type: MSE; Cost function value: 1266903.439
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1648.326 1648.986 1661.200 
## Forecast errors:
## MPE: 26.4%; Bias: 86.6%; MAPE: 39.1%; SMAPE: 48.8%
## MASE: 2.914; sMAE: 118.9%; RelMAE: 1.245; sMSE: 237.9%</code></pre>
<p>or construct a model with selected exogenous (based on IC):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="st">&quot;ZZZ&quot;</span>, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">xreg=</span>x, <span class="dt">xregDo=</span><span class="st">&quot;select&quot;</span>)</code></pre></div>
<pre><code>## Time elapsed: 0.25 seconds
## Model estimated: ETS(MNN)
## Persistence vector g:
## alpha 
## 0.145 
## Initial values were optimised.
## 3 parameters were estimated in the process
## Residuals standard deviation: 0.415
## Cost function type: MSE; Cost function value: 1288657.07
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1647.978 1648.413 1658.277 
## Forecast errors:
## MPE: 26.3%; Bias: 87%; MAPE: 39.8%; SMAPE: 49.4%
## MASE: 2.944; sMAE: 120.1%; RelMAE: 1.258; sMSE: 242.7%</code></pre>
<p>or the one with the updated xreg:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ourModel &lt;-<span class="st"> </span><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="st">&quot;ZZZ&quot;</span>, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">xreg=</span>x, <span class="dt">updateX=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>If we want to check if lagged x can be used for forecasting purposes, we can use <code>xregExpander()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span><span class="st">&quot;ZZZ&quot;</span>, <span class="dt">h=</span><span class="dv">18</span>, <span class="dt">holdout=</span><span class="ot">TRUE</span>, <span class="dt">xreg=</span><span class="kw">xregExpander</span>(x), <span class="dt">xregDo=</span><span class="st">&quot;select&quot;</span>)</code></pre></div>
<pre><code>## Time elapsed: 1.2 seconds
## Model estimated: ETSX(MNN)
## Persistence vector g:
## alpha 
## 0.165 
## Initial values were optimised.
## 4 parameters were estimated in the process
## Residuals standard deviation: 0.405
## Xreg coefficients were estimated in a normal style
## Cost function type: MSE; Cost function value: 1226908.762
## 
## Information criteria:
##      AIC     AICc      BIC 
## 1643.215 1643.650 1653.514 
## Forecast errors:
## MPE: 27.4%; Bias: 86.1%; MAPE: 41.4%; SMAPE: 52%
## MASE: 3.048; sMAE: 124.4%; RelMAE: 1.302; sMSE: 255%</code></pre>
<p>If we are confused about the type of estimated model, the function <code>formula()</code> will help us:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">formula</span>(ourModel)</code></pre></div>
<pre><code>## [1] &quot;y[t] = l[t-1] * exp(a1[t-1] * x1[t] + a2[t-1] * x2[t]) * e[t]&quot;</code></pre>
<p>A feature available since 2.1.0 is fitting <code>ets()</code> model and then using its parameters in <code>es()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">etsModel &lt;-<span class="st"> </span>forecast<span class="op">::</span><span class="kw">ets</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x)
esModel &lt;-<span class="st"> </span><span class="kw">es</span>(M3<span class="op">$</span>N2457<span class="op">$</span>x, <span class="dt">model=</span>etsModel, <span class="dt">h=</span><span class="dv">18</span>)</code></pre></div>
<p>The point forecasts in the majority of cases should the same, but the prediction intervals may be different (especially if error term is multiplicative):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">forecast</span>(etsModel,<span class="dt">h=</span><span class="dv">18</span>,<span class="dt">level=</span><span class="fl">0.95</span>)</code></pre></div>
<pre><code>##          Point Forecast      Lo 95    Hi 95
## Aug 1992       8619.214 1215.16444 16023.26
## Sep 1992       8674.340 1086.29318 16262.39
## Oct 1992       8729.467  958.84520 16500.09
## Nov 1992       8784.593  832.69344 16736.49
## Dec 1992       8839.719  707.72264 16971.71
## Jan 1993       8894.845  583.82787 17205.86
## Feb 1993       8949.971  460.91328 17439.03
## Mar 1993       9005.097  338.89106 17671.30
## Apr 1993       9060.223  217.68056 17902.77
## May 1993       9115.349   97.20746 18133.49
## Jun 1993       9170.475  -22.59688 18363.55
## Jul 1993       9225.602 -141.79599 18593.00
## Aug 1993       9280.728 -260.44882 18821.90
## Sep 1993       9335.854 -378.61019 19050.32
## Oct 1993       9390.980 -496.33117 19278.29
## Nov 1993       9446.106 -613.65942 19505.87
## Dec 1993       9501.232 -730.63954 19733.10
## Jan 1994       9556.358 -847.31330 19960.03</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">forecast</span>(esModel,<span class="dt">h=</span><span class="dv">18</span>,<span class="dt">level=</span><span class="fl">0.95</span>)</code></pre></div>
<pre><code>##          Point forecast Lower bound (2.5%) Upper bound (97.5%)
## Aug 1992       8619.214           3718.750            20027.02
## Sep 1992       8674.340           3667.184            20905.62
## Oct 1992       8729.467           3693.685            21948.30
## Nov 1992       8784.593           3710.323            22433.15
## Dec 1992       8839.719           3790.705            23381.36
## Jan 1993       8894.845           3781.971            24264.63
## Feb 1993       8949.971           3946.060            25370.27
## Mar 1993       9005.097           3878.691            25753.69
## Apr 1993       9060.223           3957.650            26632.80
## May 1993       9115.349           3871.226            27739.08
## Jun 1993       9170.475           3937.942            29093.26
## Jul 1993       9225.602           4024.792            29788.33
## Aug 1993       9280.728           3948.141            30591.66
## Sep 1993       9335.854           4062.080            31075.89
## Oct 1993       9390.980           4127.272            32791.34
## Nov 1993       9446.106           4130.050            33502.43
## Dec 1993       9501.232           4174.848            33832.07
## Jan 1994       9556.358           4190.617            36149.46</code></pre>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
